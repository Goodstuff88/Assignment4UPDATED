---
title: "Assignment 4"
author: "Gustav Oosthuizen - OSTGUS001"
date: '`r format(Sys.Date(), "%d-%B-%Y")`'
output:
  pdf_document:
    highlight: pygments
    keep_tex: yes
    number_sections: yes
    toc: yes
    toc_depth: 4
    fig_caption: true
citation_package: "biblatex"
bibliography: "Ass_4.bib"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\pagebreak

```{r installing packages, include=FALSE}

#Steps:

# 1. Installing packages used for analysis :

#install.packages("tidyverse")
#install.packages("remotes")
#install.packages("rgdal")
#install.packages("spdplyr")
#install.packages("sf")
#install.packages("countrycode")
#install.packages("ggmap")
#install.packages("rnaturalearth")
#install.packages("rnaturalearthdata")
#install.packages("gganimate")
#install.packages("mapdata")
#install.packages("devtools")
#install.packages("Rtools")
#devtools::install_github("thomasp85/gganimate/releases/tag/v0.1.1", force = TRUE)
# install.packages("gifski")
#install.packages("caTools")
#install.packages("shiny")
#install.packages("shinydashboard")
#install.packages("gapminder")
#install.packages("DT")
install.packages("RColorBrewer")

library(RColorBrewer)
library(DT)
library(shinydashboard)
library(gapminder)
library(shiny)
library(caTools)
library(gifski)
library(devtools)
library(tidyverse)
library(remotes)
library(plotly)
library(leaflet)
library(rgdal)
library(spdplyr)
library(sf)
library(countrycode)
library(ggmap)
library(rnaturalearth)
library(rnaturalearthdata)
library(rnaturalearthhires)
library(gganimate)
library(mapdata)


# 2. Installing packages used to get corona virus data set

#remotes::install_github('pzhaonet/ncovr')
#install.packages("ncovr")
#library(ncovr)

```


\section{Data wrangling} \label{DW section}

The data wrangling consist of importing, tidying and transforming the data set [@wickham2016r].

\subsection{Imporing data} 

As mentioned in section \ref{DW section} the first step of data wrangling is importing the data.

***** START CODE - for reproduceability *****

```{r Loading new ncov data}

# Loading latest data (not going to be used for analysis)

# ncov_new <- read.csv("https://raw.githubusercontent.com/datasets/covid-19/master/data/time-series-19-covid-combined.csv")

# Loading the data up to the 23/03/2020

# For reproduceability

ncov_new <- read.csv(file = "time_series_19_covid_combined_23_03_2020.csv", stringsAsFactors = FALSE)


```


\subsection{Tiding and transforming the data}

The second and thrid steps of data wrangling is tiding and transforming the data. The variables of the "ncovr_new" data set will be investigated and the nesseccary changes/transformations will be made to get the data in a tidy format.   


```{r Investigating variables and treating missing values in data sets}

# Steps:

# 1. Investigating type and structre of data

glimpse(ncov_new)

str(ncov_new)

# Remark: The "Date" variable should of type date not factor:


# 2. Checking for NA values in data set

sum(is.na(ncov_new$Province.State))
sum(is.na(ncov_new$Country.Region))
sum(is.na(ncov_new$Lat))
sum(is.na(ncov_new$Long))
sum(is.na(ncov_new$Date))
sum(is.na(ncov_new$Confirmed))
sum(is.na(ncov_new$Recovered))
sum(is.na(ncov_new$Deaths))

# Remark: Seems as if there is only missing values in the "Recovered" variable

# 3. Looking at missing value instances

ncov_new %>% 
  filter(is.na(Recovered))

# 3.1 Replace NA values with 0

ncov_new$Recovered[is.na(ncov_new$Recovered)] <- 0

ncov_new %>% 
  filter(is.na(Recovered))

```

```{r Additions and transformations to data set}

# 1. Changing the format of the "Date" variable

ncov_new$Date <- as.Date(ncov_new$Date,)

# 2. Adding a variable "Infected" which is the number of accounts of people that are still undergoing treatment.

ncov_new <- ncov_new %>% 
  mutate(Infected = Confirmed - Recovered - Deaths)


# 3. Renaming some of the variables to make it more intuitive

ncov_new <- ncov_new %>% 
  rename(Cum_Confirmed = Confirmed,
         Province_State = Province.State,
         Country_Region = Country.Region)

```


```{r Loading of spatial data}

# Note: The following spatial data was obtained by installing the naturalearth packages.

# Loading of the world data 

World <- ne_countries(scale = "medium", returnclass = "sf")
  

```


```{r Making neccessary changes to accomplish merging of ncov_new and World data frames}

# Note: The "Country_Region" variable will be used to join the spatial data frame (obtained by the rnaturalearth packages) and the ncov_new data frame. Therfore, a geometry variable will be added to the ncov_new data frame.  

# Steps:

# 1. Testing to see which country names do NOT coincide between the two data frames.

# 1.1 Creating a data frame (World_df) that list all the countries of the natural earth data.

World_df <- data.frame( Country_Region = World$name_long,
                        Pop_Estimate = World$pop_est
)


# 1.2 Joining the ncov_new data frame with the World_df date frame to investigate cases where Pop_Estimate is NA (i.e to investigate where there is a mis match in country names)

Country_Test_df <- left_join(ncov_new, World_df, by = "Country_Region" )

sum(is.na(Country_Test_df$Pop_Estimate))

# Remark: There is NA's present. These country names that cause this should be investigated

# 1.3 Investigation of the countries that present NA values

 Mismatch_Countries <- filter(Country_Test_df, is.na(Pop_Estimate)) %>%
  group_by(Country_Region) %>%
  summarise(count = n())

 # Remark: Luckily, there is only 15 counties that does not cooincide. These countries will be manually renamed so that they can be merged successfully.  
 
# 1.4  Change the following names of the ncov_new data set. ("old name" -> "new name")

# 1. Brunei -> Brunei Darussalam 
# 2. Congo (Brazzaville) -> Republic of the Congo
# 3. Congo (Kinshasa) -> Democratic Republic of the Congo
# 4. Cote d'Ivoire -> Côte d'Ivoire 
# 5. Cruise Ship -> Japan 
# 6. Czechia -> Czech Republic 
# 7. Eswatini -> eSwati
# 8. Gambia, The ->The Gambia
# 9. Holy See -> Vatican 
# 10. Korea, South -> Republic of Korea 
# 11. North Macedonia -> Macedonia 
# 12. Russia -> Russian Federation 
# 13. Taiwan* -> Taiwan 
# 14. US -> United States 
# 15. Cabo Verde -> Republic of Cabo Verde 

ncov_new$Country_Region[ncov_new$Country_Region == "Brunei"] <- "Brunei Darussalam"

ncov_new$Country_Region[ncov_new$Country_Region == "Congo (Brazzaville)"] <- "Republic of Congo"

ncov_new$Country_Region[ncov_new$Country_Region == "Congo (Kinshasa)"] <- "Democratic Republic of the Congo"

ncov_new$Country_Region[ncov_new$Country_Region == "Cote d'Ivoire"] <- "Côte d'Ivoire"

ncov_new$Country_Region[ncov_new$Country_Region == "Cruise Ship"] <- "Japan"

ncov_new$Country_Region[ncov_new$Country_Region == "Czechia"] <- "Czech Republic"

ncov_new$Country_Region[ncov_new$Country_Region == "Eswatini"] <- "Swaziland"

ncov_new$Country_Region[ncov_new$Country_Region == "Gambia"] <- "The Gambia"

ncov_new$Country_Region[ncov_new$Country_Region == "Holy See"] <- "Vatican"

ncov_new$Country_Region[ncov_new$Country_Region == "Korea, South"] <- "Republic of Korea"

ncov_new$Country_Region[ncov_new$Country_Region == "Russia"] <- "Russian Federation"

ncov_new$Country_Region[ncov_new$Country_Region == "US"] <- "United States"

ncov_new$Country_Region[ncov_new$Country_Region == "Cabo Verde"] <- "Cape Verde"

ncov_new$Country_Region[ncov_new$Country_Region == "North Macedonia"] <- "Macedonia"

ncov_new$Country_Region[ncov_new$Country_Region == "Taiwan*"] <- "Taiwan" 


# 1.5 Re-joining the Country_Test_df with changed country names

Country_Test_df <- left_join(ncov_new, World_df, by = "Country_Region" )

sum(is.na(Country_Test_df$Pop_Estimate))


# Remark: There are no missing values, therefore ALL the country names of the ncov_new data set and the spatial data set coincides and the ACTUAL merging of features can continue.


# 2. Creating Spatial data frame that only contains the important features from the world data set and storing in World_Merge_df. The spatial data frame will be used in the merging operation in the next code chunk.

World_Merge_df <- World %>% 
  select(name_long,continent) %>%
  rename(Country_Region  = name_long)

```


```{r Merging operation of spatial data}

# The following code chunk deals with creating a data frame that contains the nessecceray data that will be used to create plots of a world map.


# Steps:

# 1. Creating the data frame that encapsulates all the data needed for creating the animation. The data frame basically gives a count summary of each country in the data set per day (from 2020-01-22 to 2020-03-23) 


ncov_new_FINAL_data <-  ncov_new %>% 
  group_by(Date, Country_Region) %>% 
  summarise(Cum_Confirmed_Country = sum(Cum_Confirmed),
            Recovered_Country = sum(Recovered),
            Deaths_Country = sum(Deaths),
            Infected_Country = sum(Infected)) %>% 
  as.data.frame()


# 1.1 Changing Some variables that are type double to integer
 
ncov_new_FINAL_data$Recovered_Country <- as.integer(ncov_new_FINAL_data$Recovered_Country)
ncov_new_FINAL_data$Infected_Country <- as.integer(ncov_new_FINAL_data$Infected_Country)


# 2. Merging of data with Spatial data from the natureal earth packages

ncov_new_Spatial <- left_join(ncov_new_FINAL_data, World_Merge_df , by = "Country_Region")

# 2.1 Classifying the geometry feature in data frame

st_geometry(ncov_new_Spatial) <- ncov_new_Spatial$geometry


```


\section{Visualisations}

Part 1 - Animation

```{r  Creating animation for "slide show" creation}

# Note: The following code will be associated with creating animations that will be used in the final slide show

World %>% 
  st_set_geometry(value = NULL) %>% 
  group_by(continent) %>% 
  summarise(n = n())

# Steps: 

# 1) Creating World map gif

World_points<- st_centroid(ncov_new_Spatial)
World_points <- cbind(ncov_new_Spatial, st_coordinates(st_centroid(ncov_new_Spatial$geometry)))


 World_Map <- ggplot()  +
   geom_sf(data = World, fill = "gray48") + 
   geom_sf(data = ncov_new_Spatial, aes(frame = Date, fill = Cum_Confirmed_Country)) +
    scale_fill_gradient(low="white", high="red", trans = "log10") + 
   labs(title = "Cumalative confirmed cases of covid 19 - World Map", subtitle = "Date: {current_frame}", x = "Latitude",
       y = "Longitude", fill = "Count") + 
   theme(plot.title = element_text(size = 14, face = "bold"), 
         panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
   

World_Map_anim <-  World_Map + transition_manual(Date)

World_Map_Gif <- animate(World_Map_anim, fps = 5, width = 950, height = 850)

anim_save("1.World_Map.gif", animation = World_Map_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )


# 2) Africa gif

ncov_new_Spatial_Afr <- ncov_new_Spatial %>% 
  filter(continent == "Africa")

World_Points_Afr <- st_centroid(ncov_new_Spatial_Afr)

World_Points_Afr <- cbind(ncov_new_Spatial_Afr, st_coordinates(st_centroid(ncov_new_Spatial_Afr$geometry)))

Africa_data <- World %>% 
  filter(continent == "Africa")

Map_Afr <- ggplot() + 
  geom_sf(data = Africa_data, fill = "gray48" ) +
  geom_sf(data = ncov_new_Spatial_Afr, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_Afr, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE) + labs(title = "Cumalative confirmed cases of covid 19 - Africa", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"), panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
  
Map_Afr_Anim <-  Map_Afr  + 
  transition_manual(Date)

Afr_Gif <-  animate(Map_Afr_Anim, fps = 5, width = 950, height = 750)

anim_save("2.Afr.gif", animation = Afr_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )

# 3) Europe gif

ncov_new_Spatial_Eur <- ncov_new_Spatial %>% 
  filter(continent == "Europe")

World_Points_Eur <- st_centroid(ncov_new_Spatial_Eur)

World_Points_Eur <- cbind(ncov_new_Spatial_Eur, st_coordinates(st_centroid(ncov_new_Spatial_Eur$geometry)))

Europe_data <- World %>% 
  filter(continent == "Europe")

Map_Eur <- ggplot() + 
  geom_sf(data = Europe_data, fill = "gray48") +
  geom_sf(data = ncov_new_Spatial_Eur, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  coord_sf(xlim = c(-40, 100), ylim = c(30,75), expand = FALSE) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_Eur, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE) + labs(title = "Cumalative confirmed cases of covid 19 - Europe", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"), panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
  
Map_Eur_Anim <-  Map_Eur  + 
  transition_manual(Date)

Eur_Gif <-  animate(Map_Eur_Anim, fps = 5, width = 950, height = 750)

anim_save("3.Eur.gif", animation = Eur_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )


# 4) Asia gif

ncov_new_Spatial_Asia <- ncov_new_Spatial %>% 
  filter(continent == "Asia")

World_Points_Asia <- st_centroid(ncov_new_Spatial_Asia)

World_Points_Asia <- cbind(ncov_new_Spatial_Asia, st_coordinates(st_centroid(ncov_new_Spatial_Asia$geometry)))

Asia_data <- World %>% 
  filter(continent == "Asia")

Map_Asia <- ggplot() + 
  geom_sf(data = Asia_data, fill = "gray48") +
  geom_sf(data = ncov_new_Spatial_Asia, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_Asia, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE) + labs(title = "Cumalative confirmed cases of covid 19 - Asia", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"), panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
  
Map_Asia_Anim <-  Map_Asia  + 
  transition_manual(Date)

Asia_Gif <-  animate(Map_Asia_Anim, fps = 5, width = 950, height = 750)

anim_save("4.Asia.gif", animation = Asia_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )

# 5) North America gif

ncov_new_Spatial_USA <- ncov_new_Spatial %>% 
  filter(continent == "North America")

World_Points_USA <- st_centroid(ncov_new_Spatial_USA)

World_Points_USA <- cbind(ncov_new_Spatial_USA, st_coordinates(st_centroid(ncov_new_Spatial_USA$geometry)))

USA_data <- World %>% 
  filter(continent == "North America")

Map_USA <- ggplot() + 
  geom_sf(data = USA_data, fill = "gray48") +
  geom_sf(data = ncov_new_Spatial_USA, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  coord_sf(xlim = c(-180,-10), ylim = c(5, 85), expand = FALSE) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_USA, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE) + labs(title = "Cumalative confirmed cases of covid 19 - North America", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"), panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
  
Map_USA_Anim <-  Map_USA  + 
  transition_manual(Date)

USA_Gif <-  animate(Map_USA_Anim, fps = 5, width = 950, height = 750)

anim_save("5.USA.gif", animation = USA_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )

# 6) Oceania gif

ncov_new_Spatial_Oce <- ncov_new_Spatial %>% 
  filter(continent == "Oceania")

World_Points_Oce <- st_centroid(ncov_new_Spatial_Oce)

World_Points_Oce <- cbind(ncov_new_Spatial_Oce, st_coordinates(st_centroid(ncov_new_Spatial_Oce$geometry)))

Oceania_data <- World %>% 
  filter(continent == "Oceania")

Map_Oce <- ggplot() + 
  geom_sf(data = Oceania_data, fill = "gray48") +
  geom_sf(data = ncov_new_Spatial_Oce, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  coord_sf(xlim = c(110,190), ylim = c(-60,20), expand = FALSE) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_Oce, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE, size = 6) + labs(title = "Cumalative confirmed cases of covid 19 - Oceania", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"), panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
  
Map_Oce_Anim <-  Map_Oce  + 
  transition_manual(Date)

Oce_Gif <-  animate(Map_Oce_Anim, fps = 5, width = 950, height = 750)

anim_save("6.Oce.gif", animation = Oce_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )

# 7) South America gif

ncov_new_Spatial_SAm <- ncov_new_Spatial %>% 
  filter(continent == "South America")

World_Points_SAm <- st_centroid(ncov_new_Spatial_SAm)

World_Points_SAm <- cbind(ncov_new_Spatial_SAm, st_coordinates(st_centroid(ncov_new_Spatial_SAm$geometry)))

SAm_data <- World %>% 
  filter(continent == "South America")

Map_SAm <- ggplot() + 
  geom_sf(data = SAm_data, fill = "gray48") +
  geom_sf(data = ncov_new_Spatial_SAm, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  coord_sf(xlim = c(-100,-30), ylim = c(-60,20), expand = FALSE) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_SAm, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE) + labs(title = "Cumalative confirmed cases of covid 19 - South America", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"), panel.grid.major = element_line(color = "gray65", linetype = "dashed", size = 0.5), panel.background = element_rect(fill = "aliceblue"))
  
Map_SAm_Anim <-  Map_SAm  + 
  transition_manual(Date)

SAm_Gif <-  animate(Map_SAm_Anim, fps = 5, width = 950, height = 750)

anim_save("7.SAm.gif", animation =SAm_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )

# 8) Seven seas (open ocean) gif (Not very imformative)

ncov_new_Spatial_SS <- ncov_new_Spatial %>% 
  filter(continent == "Seven seas (open ocean)")

World_Points_SS <- st_centroid(ncov_new_Spatial_SS)

World_Points_SS <- cbind(ncov_new_Spatial_SS, st_coordinates(st_centroid(ncov_new_Spatial_SS$geometry)))

SS_data <- World %>% 
  filter(continent == "Seven seas (open ocean)")

Map_SS <- ggplot() + 
  geom_sf(data = SS_data) +
  geom_sf(data = ncov_new_Spatial_SS, aes(frame = Date, fill = Cum_Confirmed_Country)) +
  scale_fill_gradient(low="white", high="red", trans = "log10") +
  geom_text(data = World_Points_SS, aes(x = X, y = Y, label = Cum_Confirmed_Country), check_overlap = FALSE) + labs(title = "Cumalative confirmed cases of covid 19 - Seven seas", subtitle = "Date: {current_frame}", fill = "Count", x = "Latitude", y = "Longitude" ) + 
  theme(title = element_text(size = 14, face = "bold"))
  
Map_SS_Anim <-  Map_SS  + 
  transition_manual(Date)

SS_Gif <-  animate(Map_SS_Anim, fps = 5, width = 950, height = 750)

anim_save("SS.gif", animation =SS_Gif, path = "C:/Users/Gustav/Desktop/MSc Data Science 1st year/Exploratory data analysis/Assignments/Assignment4" )

```

```{r Importing the merged gif file}

# Doesnt seem to work

Covid_19_gif <- read.gif("Ass_4_gif.gif")

```

Part 2: Shiny app development


```{r Shiny app development}

# Steps:

# 1 Code that will give the output for the dashboard

# 1.1 Determining global count of each variable (Cumalative confirmed, deaths, recoveries etc.)

Covid_Col_Sums <- ncov_new_FINAL_data %>%
  subset(Date == "2020-03-23") %>%
  select(-Country_Region, -Date) %>% 
  colSums()

# 1.2 Creating Ranking table of countries

Rank_Country_Table <- ncov_new_FINAL_data %>% 
       subset(Date == "2020-03-23") %>% 
       select(Country_Region, Cum_Confirmed_Country) %>% 
     arrange(desc(Cum_Confirmed_Country)) %>%   
      rename(Country = Country_Region,
            Cases = Cum_Confirmed_Country )

# 1.3 Filtering to the desired date of user to reveal map and creating colour pallet

Map_Data <- ncov_new_Spatial %>% 
  filter(Date == "2020-03-23")

Countries_pal <- colorNumeric(palette = "Reds",
                              domain = log(Map_Data$Cum_Confirmed_Country))



#2.1 Define all the elements of the  header, sidebar and body of the dashboard. 

header <- dashboardHeader(
  title = "Covid 19 - 23/03/2020"
  
)

sidebar <- dashboardSidebar(
  
# Adding tabs to the sidebar in the dashboard
  
sidebarMenu(
menuItem("Word Data",
tabName = "world_data"),
menuItem("Country/Region Data",
tabName = "country_region_data")
 )
)
  

body <- dashboardBody(
  
# Linking the tabs created in the sidebar to reflect in the body of the dashboard
  
 tabItems(
tabItem(tabName = "world_data",

fluidRow(
  
  column( width = 3,
        valueBox(subtitle = "Global confirmed cases",
                value = Covid_Col_Sums[[1]],
                icon = icon(name = "globe"),
                
                width = 12)  
    
  ),
  column( width = 3,
          valueBox(subtitle = "Global deaths",
                value = Covid_Col_Sums[[3]],
                icon = icon("dizzy", lib = "font-awesome" ),
               # color = "red",
                width = 12)
    
  ),
  column(width = 3,
         valueBox(subtitle = "Global recoveries",
                value = Covid_Col_Sums[[2]],
                icon = icon("clipboard-check"),
               # color = "green",
                width = 12)
  ),
  column(width = 3,
         valueBox(subtitle = "Global infected cases",
                value = Covid_Col_Sums[[4]],
                icon = icon("stethoscope"),
                #color = "yellow",
                width = 12)
         )
  
  
),

# Creating space for leaflet and table output 

fluidRow(
  
  column(width = 8,
      leafletOutput("World_Map")
         ),
  column(width = 4,
         dataTableOutput("World_Table"))
  
 )
        
),
tabItem(tabName = "country_region_data",
"The country data")
 )
)



ui <- dashboardPage(header, sidebar, body)



server <- function(input, output){
  
# World data tab
   output$World_Map <- renderLeaflet({
     Map_Data %>% 
     leaflet() %>% 
       addProviderTiles(provider = "CartoDB") %>%  
       addPolygons(weight = 1,
                   fillOpacity = 0.4,
                   color = ~Countries_pal(log(Cum_Confirmed_Country)),
                   popup = ~paste0("<b>", Country_Region, "</b>","<br/>",
                                   "Cases:", Cum_Confirmed_Country,"<br/>",
                                   "Deaths:", Deaths_Country, "<br/>",
                                   "Recoveries:", Recovered_Country,"<br/>",
                                   "Infected:", Infected_Country),
                   highlight = highlightOptions(weight = 3,
                                                color = "blue",
                                                bringToFront = TRUE)
       ) 
     
   })
   
# Things to add to plot   
# 1. SetMaxBounds() <-  the restrict the user from using only one world map
# 2. addPopups Pop-ups
# 3. ~ use to acess labels
# 4. addResetMapButton() to reset teh map to its default position
   
# World table output
   output$World_Table <- renderDataTable({Rank_Country_Table})
   
  
  
}

shinyApp(ui = ui, server = server )


```


```{r Test if probelem is in join operation}

previewColors(pal = Countries_pal,
              values = c(100,500,1000,5000,10000,50000, 10000000))


```


```{r}
Map_Data %>% 
leaflet() %>% 
       addTiles() %>% 
       addPolygons()
       

class(Map_Data$geometry)

```

**** Example ****


As seen by figure \ref{fig:Normal_Distribution}, the normal distribution is plotted.
Remember the default figure width height is 6 x 4.5 

```{r Normal_Distribution, fig.height= 3, fig.width=4.5 , fig.align='center', fig.cap= "The normal distribution curve", echo=FALSE}

x <- rnorm(100)

hist(x)


```


\pagebreak

\section{References}

